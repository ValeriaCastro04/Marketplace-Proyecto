<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proceso de Pago</title>
    <link rel="stylesheet" href="css/proceso_pago.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <h1 id="inf_pago">PROCESO DE PAGO</h1>

    <div class="indicador_progreso">
        <table>
            <tr>
                <td><span class="punto gris"></span></td>
                <td><span class="punto rojo"></span></td>
                <td><span class="punto gris"></span></td>
            </tr>
        </table>
    </div>

    <div class="container_pago">
        <div class="formulario_pago">
            <div class="logos_tarjetas">
                <img src="img/mastercard.png" alt="Logo Mastercard" class="logo_tarjeta">
                <img src="img/visa.png" alt="Logo Visa" class="logo_tarjeta">
                <img src="img/americanexpress.png" alt="Logo American Express" class="logo_tarjeta">
            </div>

            <form id="form_pago">
                <label for="nombre">Nombre</label>
                <input type="text" id="nombre" class="input_pago" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s'-]+" placeholder="Ingresa tu nombre" required>

                <label for="num_tarjeta">Num de tarjeta</label>
                <input type="text" id="num_tarjeta" class="input_pago" pattern="[\d-]{1,15}" placeholder="Ingresa tu número de tarjeta"  required>

                <div class="cvv_exp">
                    <div class="cvv">
                        <label for="cvv">CVV</label>
                        <input type="text" id="cvv" class="input_pago" pattern="\d{3}" title="Ingrese XXX" placeholder="CVV" required>
                    </div>
                    <div class="expiracion">
                        <label for="expiracion">Expiración</label>
                        <input type="date" id="expiracion" class="input_pago" placeholder="MM/YY" required>
                    </div>
                </div>

                <button type="submit" class="boton_pagar">PAGAR</button>
            </form>
        </div>

        <div class="detalle_carrito">
            <div class="producto">
            </div>

            <div class="subtotal">
                <p>Subtotal (items): <span>$</span></p>
            </div>
        </div>

    </div>
    <script>
        // Función para validar el número de tarjeta usando el Algoritmo de Luhn
        function validarTarjeta(numeroTarjeta) {
            let suma = 0;
            let esPar = false;
            for (let i = numeroTarjeta.length - 1; i >= 0; i--) {
                let digito = parseInt(numeroTarjeta[i]);
    
                if (esPar) {
                    digito *= 2;
                    if (digito > 9) digito -= 9;
                }
    
                suma += digito;
                esPar = !esPar;
            }
    
            return suma % 10 === 0;
        }
    
        // Evento de envío del formulario
        document.getElementById('form_pago').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevenir el envío del formulario
    
            const numeroTarjeta = document.getElementById('num_tarjeta').value.replace(/\s+/g, '');
            
            // Validar si el número de tarjeta es correcto
            if (validarTarjeta(numeroTarjeta)) {
                // Mostrar notificación de éxito si la tarjeta es válida
                Swal.fire({
                    title: "¡Compra exitosa!",
                    text: "Tu pedido fue realizado correctamente.",
                    icon: "success"
                });
            } else {
                // Mostrar notificación de error si la tarjeta es inválida
                Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Ocurrió un error con el método de pago. No se puede completar la compra."
                });
            }
        });
    </script>
    
</body>
</html>
