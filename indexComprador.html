<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiVARMARKET</title>
    <link rel="stylesheet" href="css/index_comprador.css">
    <style>
        /* Estilos del contenedor y elementos para el carrusel */
        .carousel {
            display: flex;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
            position: relative;
            width: 99%;
            margin: auto;
        }
    
        .carousel-items {
            display: flex;
            transition: transform 0.5s ease-in-out;
            will-change: transform;
            gap: 15px; /* Añadí un gap para mantener una separación constante */
        }
    
        .item {
            min-width: 220px;
            flex-shrink: 0;
            text-align: center;
            background-color: #fff;
            padding: 10px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }
    
        .arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
            z-index: 1;
        }
    
        .arrow-left {
            left: -10px; /* Ajusté la posición para mejor alineación */
        }
    
        .arrow-right {
            right: -10px; /* Ajusté la posición para mejor alineación */
        }
    
        .item img {
            max-width: 100%;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div>
<header>
    <img src="img/SiVARMARKET -LOGO1.png" alt="SiVARMARKET Logo" id="logo">
    <div class="container-icon">
        <div class="container-cart-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="icon-cart">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
              </svg>                   
            <div class="count-products">
                <span id="contador-productos">0</span>
            </div> 
        </div>
        <div class="container-cart-products hidden-cart">
            <div class="row-product hidden">
                <div class="cart-product">
                    <div class="info-cart-product">
                        <span class="cantidad-producto-carrito">1</span>
                        <p class="titulo-producto-carrito">Zapatos Nike</p>
                        <span class="precio-producto-carrito">$80</span>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="icon-close">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                    </svg> 
                </div>
            </div>
            <div class="cart-total hidden">
                <h3>Total:</h3>
                <span class="total-pagar">$200</span>
            </div>
            <p class="cart-empty">El carrito esta vacío</p>
        </div>             
    </div>
</header>
</div>
<div class="separador"></div>

<div class="titulo-categorias">
    <h1>Categorías</h1>
</div>
<div class="container-categorias">
    <div class="categoria">
        <figure>
            <img src="https://www.anahuac.mx/mexico/sites/default/files/styles/webp/public/noticias/Los-colores-que-utilizamos-en-la-ropa-dicen-como-somos.jpg.webp?itok=k3GFCGkN" alt="Categoria Ropa">
        </figure>
        <div class="info-product-1">
            <h2>Ropa</h2>
            <a href="#ropa"><button>Buscar</button></a>
        </div>
    </div>
    <div class="categoria">
        <figure>
            <img src="https://s1.elespanol.com/2022/01/04/treintayseis/economia/comercio-local/639946745_242923013_1024x576.jpg" alt="Categoria Antigüedades">
        </figure>
        <div class="info-product-1">
            <h2>Antigüedades</h2>
            <a href="#antiguedades"><button>Buscar</button></a>
        </div>
    </div>
    <div class="categoria">
        <figure>
            <img src="https://tuyomedia.sfo2.cdn.digitaloceanspaces.com/1664758140728-Kitfacialparaacn%C3%A9ymanchitas.jpeg" alt="Categoria Cuidado de la piel">
        </figure>
        <div class="info-product-1">
            <h2>Cuidado de la piel</h2>
            <a href="#skincare"><button>Buscar</button></a>
        </div>
    </div>
    <div class="categoria">
        <figure>
            <img src="https://miro.medium.com/v2/resize:fit:1400/1*B0Eva2_QTjOP9pAmjnMunQ.jpeg" alt="Categoria Emprendimientos">
        </figure>
        <div class="info-product-1">
            <h2>Emprendimientos</h2>
            <a href="#emprendimientos"><button>Buscar</button></a>
        </div>
    </div>
    <div class="categoria">
        <figure>
            <img src="https://www.estamosenlinea.co/wp-content/uploads/2024/05/Tendencia-consumo-de-lo-usado-1-002.jpg" alt="Categoria Productos usados">
        </figure>
        <div class="info-product-1">
            <h2>Productos usados</h2>
            <a href="#usados"><button>Buscar</button></a>
        </div>
    </div>
    <div class="categoria">
        <figure>
            <img src="https://i.pinimg.com/736x/a1/1a/ff/a11affbe1f566b92092d1a3eaf67f44b.jpg" alt="Categoria Artesanías">
        </figure>
        <div class="info-product-1">
            <h2>Artesanías</h2>
            <a href="#artesanias"><button>Buscar</button></a>
        </div>
    </div>
</div>
<div class="titulos">
    <h1 id="ropa">Ropa</h1>
</div>
<div class="carousel">
    <button class="arrow arrow-left" onclick="moveCarousel( 'ropa', -1)">&#10094;</button>
    <div class="carousel-items container-items" id="ropa-container"></div>
    <button class="arrow arrow-right" onclick="moveCarousel('ropa', 1)">&#10095;</button>
</div>

<div class="titulos">
    <h1 id="antiguedades">Antigüedades</h1>
</div>
<div class="carousel">
    <button class="arrow arrow-left" onclick="moveCarousel('antiguedades', -1)">&#10094;</button>
    <div class="carousel-items container-items" id="antiguedades-container"></div>
    <button class="arrow arrow-right" onclick="moveCarousel('antiguedades', 1)">&#10095;</button>
</div>

<div class="titulos">
    <h1 id="skincare">Cuidado de la piel</h1>
</div>
<div class="carousel">
    <button class="arrow arrow-left" onclick="moveCarousel('skincare', -1)">&#10094;</button>
    <div class="carousel-items container-items" id="skincare-container"></div>
    <button class="arrow arrow-right" onclick="moveCarousel('skincare', 1)">&#10095;</button>
</div>

<div class="titulos">
    <h1 id="emprendimientos">Emprendimientos</h1>
</div>
<div class="carousel">
    <button class="arrow arrow-left" onclick="moveCarousel('emprendimientos', -1)">&#10094;</button>
    <div class="carousel-items container-items" id="emprendimientos-container"></div>
    <button class="arrow arrow-right" onclick="moveCarousel('emprendimientos', 1)">&#10095;</button>
</div>

<div class="titulos">
    <h1 id="usados">Productos usados</h1>
</div>
<div class="carousel">
    <button class="arrow arrow-left" onclick="moveCarousel('usados', -1)">&#10094;</button>
    <div class="carousel-items container-items" id="usados-container"></div>
    <button class="arrow arrow-right" onclick="moveCarousel('usados', 1)">&#10095;</button>
</div>

<div class="titulos">
    <h1 id="artesanias">Artesanías</h1>
</div>
<div class="carousel">
    <button class="arrow arrow-left" onclick="moveCarousel('artesanias', -1)">&#10094;</button>
    <div class="carousel-items container-items" id="artesanias-container"></div>
    <button class="arrow arrow-right" onclick="moveCarousel('artesanias', 1)">&#10095;</button>
</div>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Configuración de Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDZigv2X5_57XfBkfE4zb2R2GobZ90igVI",
        authDomain: "proyectometodologias-2186a.firebaseapp.com",
        projectId: "proyectometodologias-2186a",
        storageBucket: "proyectometodologias-2186a.appspot.com",
        messagingSenderId: "1035665597993",
        appId: "1:1035665597993:web:fd75c9d15de9988b7a5e38"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const categoryMapping = {
        "Antigüedades": "antiguedades",
        "Cuidado de la piel": "skincare",
        "Ropa": "ropa",
        "Emprendimientos": "emprendimientos",
        "Usados": "usados",
        "Artesanías": "artesanias"
        };


        async function loadApprovedProducts() {
    try {
        const productsRef = collection(db, "productos");
        const q = query(productsRef, where("estado", "==", "aprobado"));
        const querySnapshot = await getDocs(q);

        // Verifica si se obtuvieron productos aprobados
        if (querySnapshot.empty) {
            console.warn("No se encontraron productos aprobados en la base de datos.");
            return;
        }

        querySnapshot.forEach((doc) => {
            const product = doc.data();
            console.log(`Producto encontrado: ${product.nombre}, Categoría: ${product.categoria}`);

            // Mapea la categoría del producto al ID del contenedor
            const mappedCategory = categoryMapping[product.categoria];
            const containerId = `${mappedCategory}-container`;
            const container = document.getElementById(containerId);

            if (container) {
                // Crea y agrega el producto al contenedor
                const item = document.createElement("div");
                item.classList.add("item");
                item.innerHTML = `
                    <figure>
                        <img src="${product.imagenURL}" alt="${product.nombre}">
                    </figure>
                    <div class="info-product">
                        <h2>${product.nombre}</h2>
                        <p class="price">$${product.precio}</p>
                        <button class="btn-add-cart">Añadir al carrito</button>
                    </div>
                `;
                container.appendChild(item);
                console.log(`Producto cargado en la categoría: ${product.categoria}`);
            } else {
                console.warn(`Contenedor para la categoría "${product.categoria}" no encontrado.`);
            }
        });
    } catch (error) {
        console.error("Error al cargar los productos aprobados:", error);
    }
}

loadApprovedProducts();
</script>

<script>
    // Se mantienen los offsets para cada categoría
    let currentOffsets = {
        "ropa": 0,
        "antiguedades": 0,
        "skincare": 0,
        "emprendimientos": 0,
        "usados": 0,
        "artesanias": 0
    };

    function moveCarousel(category, direction) {
    const container = document.getElementById(`${category}-container`);
    const items = container.querySelectorAll('.item');

    if (items.length === 0) return;

    // Ancho del contenedor padre
    const containerWidth = container.parentElement.offsetWidth;
    
    // Ancho de un ítem incluyendo margen
    const itemWidth = items[0].offsetWidth + 75; // Ajuste para incluir el margen
    const totalWidth = itemWidth * items.length; // Ancho total de todos los ítems

    // Limitar el desplazamiento para evitar cortar ítems
    let maxOffset = totalWidth - containerWidth;
    
    // Si el último elemento se muestra a medias, asegúrate de ajustar el offset máximo
    if (maxOffset < itemWidth) {
        maxOffset = Math.max(0, totalWidth - containerWidth);
    }

    // Actualizamos el desplazamiento de la categoría específica
    currentOffsets[category] += direction * containerWidth;

    // Limitar el desplazamiento entre 0 y el máximo posible
    if (currentOffsets[category] < 0) {
        currentOffsets[category] = 0;
    } else if (currentOffsets[category] > maxOffset) {
        currentOffsets[category] = maxOffset;
    }

    container.style.transform = `translateX(-${currentOffsets[category]}px)`;
}
</script>
<script src="js/index.js"></script>
</body>
<footer>
  <p>Marketplace para productos locales - Proyecto Metodologias Agiles</p>
</footer>
</html>
