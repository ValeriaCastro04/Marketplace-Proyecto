<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin SiVARMARKET - Panel de Control</title>
    <link rel="stylesheet" href="css/admin_style.css">
    <style>
        /* Estilos básicos */
        .productos-lista {
            margin: 20px;
        }
        .producto {
            background-color: #f1f1f1;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
        }
        /* Estilos del modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 500px;
            text-align: center;
            position: relative;
        }
        .close-btn {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover {
            color: black;
        }
        .button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .aprobar {
            background-color: green;
            color: white;
        }
        .rechazar {
            background-color: red;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1>
            <img src="img/SiVARMARKET -LOGO1.png" alt="Logo de SiVARMARKET">
            Panel de Control SiVARMARKET
        </h1>
        <nav>
            <ul>
                <li><a href="admin.html">Revisar Productos</a></li>
                <li><a href="#">Opciones</a></li>
                <li><a href="inicio.html">Cerrar sesión</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="administracion-productos">
            <h2 style="text-align: center;">Revisión de productos</h2>
            <div class="panel-control">
                <div id="productos-en-espera" class="productos-lista">
                    <h3>Productos en Espera</h3>
                    <div id="lista-espera"></div>
                </div>
                <div id="productos-aprobados" class="productos-lista">
                    <h3>Productos Aprobados</h3>
                    <div id="lista-aprobados"></div>
                </div>
                <div id="productos-rechazados" class="productos-lista">
                    <h3>Productos Rechazados</h3>
                    <div id="lista-rechazados"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal para mostrar detalles del producto -->
    <div id="modal" class="modal" onclick="cerrarModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="cerrarModal()">&times;</span>
            <h3 id="modal-producto-nombre"></h3>
            <p><strong>ID del Vendedor:</strong> <span id="modal-producto-vendedor"></span></p>
            <p><strong>Descripción:</strong> <span id="modal-producto-descripcion"></span></p>
            <p><strong>Precio:</strong> $<span id="modal-producto-precio"></span></p>
            <p><strong>Categoría:</strong> <span id="modal-producto-categoria"></span></p>
            <img id="modal-producto-imagen" src="" alt="Imagen del Producto" style="width: 100%; max-width: 200px;">
            <div id="botones-aprobacion">
                <button id="aprobar-btn" class="button aprobar">Aprobar</button>
                <button id="rechazar-btn" class="button rechazar">Rechazar</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDZigv2X5_57XfBkfE4zb2R2GobZ90igVI",
            authDomain: "proyectometodologias-2186a.firebaseapp.com",
            projectId: "proyectometodologias-2186a",
            storageBucket: "proyectometodologias-2186a.appspot.com",
            messagingSenderId: "1035665597993",
            appId: "1:1035665597993:web:fd75c9d15de9988b7a5e38"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const listaEspera = document.getElementById("lista-espera");
        const listaAprobados = document.getElementById("lista-aprobados");
        const listaRechazados = document.getElementById("lista-rechazados");

        let productoSeleccionado = null;

        async function cargarProductos() {
            try {
                const productosRef = collection(db, "productos");
                const querySnapshot = await getDocs(productosRef);

                listaEspera.innerHTML = "";
                listaAprobados.innerHTML = "";
                listaRechazados.innerHTML = "";

                querySnapshot.forEach((doc) => {
                    const producto = doc.data();
                    const productoId = doc.id;

                    const container = document.createElement("div");
                    container.classList.add("producto");
                    container.textContent = producto.nombre;
                    container.onclick = () => mostrarModal(producto, productoId);

                    if (producto.estado === "pendiente") {
                        listaEspera.appendChild(container);
                    } else if (producto.estado === "aprobado") {
                        listaAprobados.appendChild(container);
                    } else if (producto.estado === "rechazado") {
                        listaRechazados.appendChild(container);
                    }
                });

            } catch (error) {
                console.error("Error al cargar los productos:", error);
            }
        }

        function mostrarModal(producto, productoId) {
            productoSeleccionado = productoId;
            document.getElementById("modal-producto-nombre").textContent = producto.nombre;
            document.getElementById("modal-producto-vendedor").textContent = producto.vendedorId;
            document.getElementById("modal-producto-descripcion").textContent = producto.descripcion;
            document.getElementById("modal-producto-precio").textContent = producto.precio;
            document.getElementById("modal-producto-categoria").textContent = producto.categoria;
            document.getElementById("modal-producto-imagen").src = producto.imagenURL;
            
            // Oculta o muestra los botones según el estado del producto
            const botonesAprobacion = document.getElementById("botones-aprobacion");
            if (producto.estado === "pendiente") {
                botonesAprobacion.style.display = "block";
            } else {
                botonesAprobacion.style.display = "none";
            }
            
            document.getElementById("modal").style.display = "flex";
            console.log("Modal abierto con producto:", producto.nombre); // Depuración
        }

        function cerrarModal(event) {
            if (event) event.stopPropagation();
            document.getElementById("modal").style.display = "none";
        }

        async function cambiarEstadoProducto(estado) {
            if (!productoSeleccionado) return;

            const productoRef = doc(db, "productos", productoSeleccionado);

            try {
                await updateDoc(productoRef, { estado: estado });
                console.log(`Producto ${productoSeleccionado} actualizado a estado: ${estado}`);
                cerrarModal();
                cargarProductos(); // Recargar los productos para reflejar cambios
            } catch (error) {
                console.error("Error al actualizar el estado del producto:", error);
            }
        }

        // Asigna eventos a los botones de aprobar y rechazar
        document.getElementById("aprobar-btn").addEventListener("click", () => cambiarEstadoProducto("aprobado"));
        document.getElementById("rechazar-btn").addEventListener("click", () => cambiarEstadoProducto("rechazado"));

        // Llamada inicial para cargar los productos
        cargarProductos();
    </script>
</body>
</html>
